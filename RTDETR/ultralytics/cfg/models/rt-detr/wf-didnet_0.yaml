# Ultralytics YOLO ğŸš€, AGPL-3.0 license
# WF-DIDNet é…ç½®æ–‡ä»¶ (RT-DETR + DWT + SimAM)
# ç”¨äºè®­ç»ƒå»é›¾åˆ†æ”¯

# Parameters
nc: 80  # number of classes
scales: # model compound scaling constants
  l: [1.00, 1.00, 2048]

backbone:
  # [from, repeats, module, args]
  - [-1, 1, HGStem, [32, 48]]  # 0-P2/4
  - [-1, 6, HGBlock, [48, 128, 3]]  # 1-stage 1

  - [-1, 1, DWConv, [256, 3, 2]]  # 2-P3/8
  - [-1, 6, RepC3, [256]]  # 3-P3 ç‰¹å¾å±‚
  
  # === å…³é”®ä¿®æ”¹ç‚¹: æ’å…¥ SimAM å’Œ DWT ===
  - [-1, 1, SimAM, []]   # 4. æ’å…¥ SimAM æ³¨æ„åŠ›
  - [-1, 1, DWT, []]     # 5. æ’å…¥ DWT (è¾“å‡º: [B, 1024, H/2, W/2])
  # æ³¨æ„ï¼šDWT å±‚åœ¨è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†æä¾›é¢‘åŸŸç‰¹å¾ç»™å»é›¾å¤´ï¼ˆåç»­æ·»åŠ ï¼‰
  # éª¨å¹²ç½‘ç»œçš„ä¸»è·¯ç»§ç»­ä» SimAM (å±‚4) æ¥ä¸‹å»ï¼Œè€Œä¸æ˜¯æ¥ DWT (å±‚5)
  
  - [4, 1, DWConv, [512, 3, 2]]   # 6. ä»å±‚4 (SimAMå) ç»§ç»­ä¸‹é‡‡æ · -> P4/16
  - [-1, 6, RepC3, [512]] # 7. 
  - [-1, 1, SimAM, []]            # 8. æ’å…¥ SimAM

  - [-1, 1, DWConv, [1024, 3, 2]] # 9. -> P5/32
  - [-1, 6, RepC3, [1024]] # 10.
  - [-1, 1, SimAM, []]            # 11. æ’å…¥ SimAM
  
head:
  - [-1, 1, Conv, [256, 1, 1, None, 1, 1, False]]  # 12 input_proj.2 (P5)
  - [-1, 1, AIFI, [1024, 8]]
  - [-1, 1, Conv, [256, 1, 1]]   # 14

  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]
  - [8, 1, Conv, [256, 1, 1, None, 1, 1, False]]  # 16 (P4)
  - [[-2, -1], 1, Concat, [1]]
  - [-1, 3, RepC3, [256]]    # 18
  - [-1, 1, Conv, [256, 1, 1]]   # 19

  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]
  - [4, 1, Conv, [256, 1, 1, None, 1, 1, False]]  # 21 (P3)
  - [[-2, -1], 1, Concat, [1]]    
  - [-1, 3, RepC3, [256]]    # 23

  - [-1, 1, DWConv, [256, 3, 2]]   
  - [[-1, 19], 1, Concat, [1]]     
  - [-1, 3, RepC3, [256]]    # 26

  - [-1, 1, DWConv, [256, 3, 2]]   
  - [[-1, 14], 1, Concat, [1]]     
  - [-1, 3, RepC3, [256]]    # 29

  # === åŸæœ‰çš„æ£€æµ‹å¤´ ===
  - [[23, 26, 29], 1, RTDETRDecoder, [nc, 256, 300, 4, 8, 3]]  # 30. æ£€æµ‹è¾“å‡º

  # === æ–°å¢ï¼šå»é›¾åˆ†æ”¯ (ä»å±‚5 DWT å–æ•°æ®) ===
  # args: [in_ch (è‡ªåŠ¨è®¡ç®—), d_state=16, depth=2]
  - [5, 1, HighResMambaDehazeHead, [16, 2]] # 31. å»é›¾è¾“å‡º (T_map, Recon, Feat)